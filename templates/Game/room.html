{% extends 'base.html' %}

{% block title %}FunBoard{% endblock %}
{% load custom_filters %}

{% block content %}
<h1>Кімната {{ room.code }}</h1>
<h3>Гравці:</h3>
<ul id="players-list">
    {% for player in players %}
        <li>{{ player.name }}</li>
    {% endfor %}
</ul>

<script>
const roomCode = "{{ room.code }}";
const socket = new WebSocket(
    `ws://${window.location.host}/ws/room/${roomCode}/`
);

socket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    if (data.action === 'update_players') {
        // Перезавантажуємо список гравців (через простий AJAX-запит)
        fetch(window.location.href)
            .then(res => res.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                document.getElementById('players-list').innerHTML =
                    doc.getElementById('players-list').innerHTML;
            });
    }
};
</script>

{% endblock %}